<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="solar_page_title">Calculadora Solar Avanzada ☀️ | FIDES</title>
    
    <link rel="icon" href="img/favicon.ico.png">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #FDBE33; 
            --secondary-color: #4a4c70; 
            --dark-color: #20212B;      
            --light-bg: #f3f6ff;
            --success-color: #28a745;
        }

        body { background-color: var(--light-bg); }
        .main-container { padding: 40px 20px; }
        .calculator-container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1200px;
            margin: auto;
            border-top: 5px solid var(--primary-color);
        }
        .calculator-container h1 { color: var(--secondary-color); font-weight: 700; }
        .section-title {
            color: var(--secondary-color);
            font-weight: 600;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 25px;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .input-group-calc { margin-bottom: 20px; }
        .input-group-calc label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            color: var(--secondary-color);
            font-weight: 600;
        }
        .input-group-calc .form-control, .input-group-calc .form-control-range { border-radius: 8px; }
        .info-icon { margin-left: 8px; color: #777; cursor: pointer; }

        #calculateBtn {
            padding: 14px;
            background: var(--primary-color);
            color: var(--dark-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: 700;
            transition: all 0.3s;
        }
        #calculateBtn:hover { background-color: var(--secondary-color); color: #ffffff; }

        #resultado { margin-top: 40px; border-top: 2px solid #e9ecef; padding-top: 30px; }
        .result-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
            height: 100%;
        }
        .result-card h3 { color: var(--secondary-color); font-size: 1.4em; margin-bottom: 15px; }
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.95em;
        }
        .result-item:last-child { border-bottom: none; }
        .result-item strong { color: var(--secondary-color); }
        .result-item span {
            font-weight: bold;
            color: var(--dark-color);
            font-size: 1.1em;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .roi-years, .environmental-impact span, .finance-result span {
            color: var(--success-color) !important;
            font-size: 1.2em !important;
        }
        .chart-container { height: 300px; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="top-bar d-none d-md-block">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-8">
                    <div class="top-bar-left">
                        <div class="text"><i class="fa fa-envelope"></i>
                            <p data-key="email">fidessuc@gmail.com</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="navbar navbar-expand-lg bg-dark navbar-dark">
        <div class="container-fluid">
            <a href="index.html" class="navbar-brand">
                <img class="navbar-logo" src="img/logo fundacion para el desarrollo de sucre.jpg"
                    alt="Logo de la Fundación FIDES Sucre">
            </a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse"
                aria-label="Alternar navegación">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                <div class="navbar-nav ml-auto">
                    <a href="index.html" class="nav-item nav-link" data-key="nav_inicio">INICIO</a>
                    <a href="proyectos.html" class="nav-item nav-link" data-key="nav_proyectos">PROYECTOS</a>
                    <a href="galeria.html" class="nav-item nav-link" data-key="nav_galeria">GALERÍA</a>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle active" data-toggle="dropdown"
                            data-key="nav_herramientas">HERRAMIENTAS WEB</a>
                        <div class="dropdown-menu">
                             <a href="evaluador_sustentable.html" class="dropdown-item"
                                data-key="nav_evaluador">Evaluador de Sostenibilidad</a>
                            <a href="calculadora_carbono.html" class="dropdown-item"
                                data-key="nav_calculadora_carbono">Calculadora de Carbono</a>
                            <a href="calculadora_solar.html" class="dropdown-item active"
                                data-key="nav_calculadora_solar">Calculadora Solar</a>
                        </div>
                    </div>
                    <a href="blog.html" class="nav-item nav-link" data-key="nav_blog">BLOG</a>
                    <div class="nav-item d-flex align-items-center lang-switcher">
                        <a href="#" onclick="setLanguage('es'); return false;" class="lang-btn-nav">ES</a>
                        <span class="text-white mx-1">|</span>
                        <a href="#" onclick="setLanguage('en'); return false;" class="lang-btn-nav">EN</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="calculator-container" id="calculator-content">
            <div class="text-center">
                <h1 data-key="solar_main_title">Calculadora Solar Avanzada ☀️</h1>
                <p class="lead" data-key="solar_subtitle">Una herramienta de planificación completa para su proyecto de energía solar.</p>
            </div>
            
            <div class="row">
                <div class="col-lg-4">
                    <h4 class="section-title" data-key="solar_input_title_0">1. Ubicación</h4>
                    <div class="input-group-calc">
                        <label for="region" data-key="solar_region_label">Región/País</label>
                        <select id="region" class="form-control"></select>
                    </div>
                    <div class="input-group-calc">
                        <label for="ubicacion" data-key="solar_ubicacion_label">Ciudad más cercana</label>
                        <select id="ubicacion" class="form-control"></select>
                    </div>
                </div>
                <div class="col-lg-4">
                    <h4 class="section-title" data-key="solar_input_title_1">2. Consumo y Costos</h4>
                    <div class="input-group-calc">
                        <label for="consumo" data-key="solar_consumo_label">Consumo Mensual (kWh): <span id="consumoValue" class="font-weight-bold text-primary">300</span></label>
                        <input type="range" id="consumo" class="form-control-range" min="100" max="2000" step="10" value="300">
                    </div>
                    <div id="costoKwhContainer" class="input-group-calc">
                        <label for="costoKwh" data-key="solar_costo_kwh_label">Costo por kWh: <span id="costoKwhValue" class="font-weight-bold text-primary"></span></label>
                        <input type="range" id="costoKwh" class="form-control-range" min="0.10" max="0.50" step="0.01">
                    </div>
                    <div id="estratoContainer" class="input-group-calc" style="display: none;">
                        <label for="estrato" data-key="solar_estrato_label">Estrato Socioeconómico</label>
                        <select id="estrato" class="form-control"></select>
                    </div>
                </div>
                <div class="col-lg-4">
                    <h4 class="section-title" data-key="solar_input_title_2">3. Características Técnicas</h4>
                    <div class="input-group-calc">
                        <label for="sombra" data-key="solar_sombra_label">Nivel de Sombra en Tejado</label>
                        <select id="sombra" class="form-control"></select>
                    </div>
                     <div class="input-group-calc">
                        <label for="potenciaPanel" data-key="solar_potencia_panel_label">Potencia del Panel (W)</label>
                        <select id="potenciaPanel" class="form-control">
                            <option value="450">450W</option>
                            <option value="550">550W (Alta Eficiencia)</option>
                            <option value="650">650W (Grado Industrial)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <h4 class="section-title" data-key="solar_input_title_4">4. Opciones Financieras y Adicionales</h4>
            <div class="row align-items-center">
                 <div class="col-lg-4">
                     <div class="input-group-calc">
                        <label for="costoPorVatio" data-key="solar_costo_vatio_label">Costo Instalación por Vatio: <span id="costoPorVatioValue" class="font-weight-bold text-primary"></span></label>
                        <input type="range" id="costoPorVatio" class="form-control-range" min="1" max="8" step="0.1">
                    </div>
                 </div>
                 <div class="col-lg-4">
                     <div id="incentivosContainer" class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="incentivos">
                        <label class="form-check-label" for="incentivos" data-key="solar_incentivos_check">Aplicar incentivos fiscales locales</label>
                    </div>
                 </div>
                 <div class="col-lg-4">
                     <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="conBaterias">
                        <label class="form-check-label" for="conBaterias" data-key="solar_baterias_check">Calcular con baterías (sistema aislado)</label>
                    </div>
                 </div>
            </div>

            <div class="text-center mt-4">
                <button onclick="calcular()" id="calculateBtn" class="btn btn-lg" data-key="solar_calcular_btn">Calcular Mi Proyecto Solar</button>
            </div>

            <div id="resultado" style="display: none;">
                <h2 class="text-center" data-key="solar_resultados_title">Resultados de tu Proyecto</h2>
                <div class="row">
                    <div class="col-lg-4">
                        <div class="result-card">
                            <h3 data-key="solar_resumen_sistema_title"><i class="fas fa-solar-panel"></i> Sistema Requerido</h3>
                            <div class="result-item"><strong data-key="solar_paneles_label">Paneles necesarios:</strong> <span id="numeroPaneles">--</span></div>
                            <div class="result-item"><strong data-key="solar_potencia_total_label">Potencia total:</strong> <span id="potenciaTotal">--</span></div>
                            <div class="result-item"><strong data-key="solar_inversor_label">Inversor recomendado:</strong> <span id="inversor">--</span></div>
                            <div class="result-item"><strong data-key="solar_area_label">Área requerida:</strong> <span id="areaRequerida">--</span></div>
                        </div>
                    </div>
                     <div class="col-lg-4">
                        <div class="result-card">
                             <h3 data-key="solar_resumen_financiero_title"><i class="fas fa-dollar-sign"></i> Análisis Financiero</h3>
                             <div class="result-item"><strong data-key="solar_costo_sistema_label">Costo total del sistema:</strong> <span id="costoSistema">--</span></div>
                             <div class="result-item"><strong data-key="solar_ahorro_mensual_label">Ahorro mensual estimado:</strong> <span id="ahorroMensual">--</span></div>
                             <div class="result-item"><strong data-key="solar_roi_label">Recuperación de inversión:</strong> <span id="retornoInversion" class="roi-years">--</span></div>
                        </div>
                    </div>
                     <div class="col-lg-4">
                        <div class="result-card environmental-impact">
                             <h3 data-key="solar_resumen_ambiental_title"><i class="fas fa-leaf"></i> Impacto Ambiental Anual</h3>
                             <div class="result-item"><strong data-key="solar_co2_label">CO₂ evitado:</strong> <span id="co2Evitado">--</span></div>
                             <div class="result-item"><strong data-key="solar_arboles_label">Equivalente a plantar:</strong> <span id="arbolesEquivalentes">--</span></div>
                        </div>
                    </div>
                </div>
                 <div class="row">
                     <div class="col-12">
                         <div class="result-card">
                             <h3 data-key="solar_grafico_proyeccion_title"><i class="fas fa-chart-line"></i> Proyección de Ahorro Acumulado a 25 Años</h3>
                             <div class="chart-container"><canvas id="proyeccionChart"></canvas></div>
                         </div>
                     </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="result-card finance-result">
                            <h3 data-key="solar_financiacion_title"><i class="fas fa-calculator"></i> Estimador de Financiación</h3>
                            <div class="input-group-calc">
                                <label for="plazo" data-key="solar_plazo_label">Plazo del crédito (meses):</label>
                                <select id="plazo" class="form-control" onchange="calcular()"><option value="60">60</option><option value="84">84</option><option value="120">120</option></select>
                            </div>
                             <div class="result-item"><strong data-key="solar_cuota_label">Cuota mensual estimada:</strong> <span id="cuotaMensual">--</span></div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="result-card text-center" style="background-color: var(--secondary-color); color: white;">
                            <h3 data-key="solar_cta_title" style="color: var(--primary-color);"><i class="fas fa-rocket"></i> ¿Listo para empezar?</h3>
                            <p data-key="solar_cta_desc">Nuestro equipo en FIDES puede asesorarte para convertir este proyecto en realidad.</p>
                            <a href="mailto:fidessuc@gmail.com?subject=Consulta%20Proyecto%20Solar%20Calculado" class="btn btn-lg" style="background-color: var(--primary-color); color: var(--dark-color) !important;">
                                <i class="fas fa-envelope"></i> <span data-key="solar_cta_btn">Contactar a un Asesor</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-4">
                     <button id="downloadPdfBtn" class="btn btn-info"><i class="fas fa-file-pdf"></i> <span data-key="solar_pdf_btn">Descargar Reporte en PDF</span></button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        const REGION_DATA = {
            'CO': { name: 'Colombia', currency: 'COP', costoVatio: 4000, costoVatioMin: 3000, costoVatioMax: 6000, gridEmissionFactor: 0.192, incentive: 0.5, ciudades: {'Sincelejo': 5.5, 'Cartagena': 5.2, 'Barranquilla': 5.0, 'Montería': 4.8, 'Valledupar': 5.3, 'Bogotá': 4.5}, estratos: {'Estrato 1': 650, 'Estrato 2': 750, 'Estrato 3': 850, 'Estrato 4': 950, 'Estrato 5': 1100, 'Estrato 6': 1200, 'Comercial': 1000} },
            'BR': { name: 'Brasil', currency: 'BRL', costoVatio: 4.5, costoVatioMin: 3, costoVatioMax: 7, gridEmissionFactor: 0.079, incentive: 0, ciudades: {'São Paulo': 4.8, 'Rio de Janeiro': 5.1, 'Salvador': 5.4, 'Brasília': 5.6, 'Fortaleza': 5.9} },
            'ES': { name: 'España', currency: 'EUR', costoVatio: 1.4, costoVatioMin: 1.0, costoVatioMax: 2.5, gridEmissionFactor: 0.19, incentive: 0.4, ciudades: {'Madrid': 5.0, 'Barcelona': 4.8, 'Sevilla': 5.4, 'Valencia': 5.1} },
            'PT': { name: 'Portugal', currency: 'EUR', costoVatio: 1.5, costoVatioMin: 1.1, costoVatioMax: 2.6, gridEmissionFactor: 0.230, incentive: 0.17, ciudades: {'Lisboa': 4.8, 'Oporto': 4.5, 'Faro': 5.5} },
            'IT': { name: 'Italia', currency: 'EUR', costoVatio: 1.6, costoVatioMin: 1.2, costoVatioMax: 2.8, gridEmissionFactor: 0.250, incentive: 0.5, ciudades: {'Roma': 4.9, 'Milán': 4.2, 'Palermo': 5.6} },
            'FR': { name: 'Francia', currency: 'EUR', costoVatio: 1.7, costoVatioMin: 1.3, costoVatioMax: 3.0, gridEmissionFactor: 0.027, incentive: 0.145, ciudades: {'París': 3.8, 'Lyon': 4.4, 'Marsella': 5.3} }
        };

        const dom = {
            region: document.getElementById('region'),
            ubicacion: document.getElementById('ubicacion'),
            estratoContainer: document.getElementById('estratoContainer'),
            estrato: document.getElementById('estrato'),
            costoKwhContainer: document.getElementById('costoKwhContainer'),
            costoKwh: document.getElementById('costoKwh'),
            costoKwhValue: document.getElementById('costoKwhValue'),
            consumo: document.getElementById('consumo'),
            consumoValue: document.getElementById('consumoValue'),
            costoPorVatio: document.getElementById('costoPorVatio'),
            costoPorVatioValue: document.getElementById('costoPorVatioValue'),
            sombra: document.getElementById('sombra'),
            incentivosContainer: document.getElementById('incentivosContainer'),
            plazo: document.getElementById('plazo'),
        };

        let proyeccionChart;

        function updateUIForRegion() {
            const regionCode = dom.region.value;
            const data = REGION_DATA[regionCode];

            dom.ubicacion.innerHTML = Object.entries(data.ciudades).map(([ciudad, hsp]) => `<option value="${hsp}">${ciudad}</option>`).join('');

            if (data.estratos) {
                dom.estratoContainer.style.display = 'block';
                dom.costoKwhContainer.style.display = 'none';
                dom.estrato.innerHTML = Object.entries(data.estratos).map(([nombre, costo]) => `<option value="${costo}">${nombre}</option>`).join('');
            } else {
                dom.estratoContainer.style.display = 'none';
                dom.costoKwhContainer.style.display = 'block';
                const avgPrice = (data.currency === 'EUR') ? 0.25 : 0; // Default for non-estrato countries
                dom.costoKwh.value = avgPrice;
                dom.costoKwhValue.innerText = `${avgPrice.toFixed(2)} ${data.currency}`;
            }
            
            dom.costoPorVatio.min = data.costoVatioMin;
            dom.costoPorVatio.max = data.costoVatioMax;
            dom.costoPorVatio.value = data.costoVatio;
            dom.costoPorVatioValue.innerText = `${data.costoVatio.toLocaleString('es-CO')} ${data.currency}`;
            
            dom.incentivosContainer.style.display = data.incentive > 0 ? 'block' : 'none';
        }

        function calcular() {
            const regionCode = dom.region.value;
            const regionData = REGION_DATA[regionCode];
            
            const consumoMensual = parseFloat(dom.consumo.value);
            const costoKwh = regionData.estratos ? parseFloat(dom.estrato.value) : parseFloat(dom.costoKwh.value);
            const horasSolPico = parseFloat(dom.ubicacion.value);
            const sombraFactor = parseFloat(dom.sombra.value);
            const potenciaPanel = parseFloat(document.getElementById('potenciaPanel').value);
            const costoPorVatio = parseFloat(dom.costoPorVatio.value);
            const conBaterias = document.getElementById('conBaterias').checked;
            const diasAutonomia = parseFloat(document.getElementById('diasAutonomia').value);
            const aplicaIncentivos = document.getElementById('incentivos').checked;

            if (!consumoMensual || !costoKwh || !horasSolPico || !potenciaPanel || !costoPorVatio) {
                alert("Por favor, completa todos los campos para continuar.");
                return;
            }
            
            const factorPerdidas = 0.80 * sombraFactor; 
            const consumoDiario = consumoMensual / 30;
            const energiaNecesaria = consumoDiario / factorPerdidas;
            const produccionPanelDiaria = (potenciaPanel * horasSolPico) / 1000;
            const numeroPaneles = Math.ceil(energiaNecesaria / produccionPanelDiaria);
            const potenciaTotal = (numeroPaneles * potenciaPanel) / 1000;
            const produccionDiariaEstimada = numeroPaneles * produccionPanelDiaria * factorPerdidas;
            const produccionAnualEstimada = produccionDiariaEstimada * 365;

            let costoTotalSistema = (potenciaTotal * 1000) * costoPorVatio;
            const ahorroMensual = produccionDiariaEstimada * costoKwh * 30;
            
            let costoParaROI = costoTotalSistema;
            if (aplicaIncentivos && regionData.incentive > 0) {
                costoParaROI *= (1 - regionData.incentive);
            }
            const retornoInversionAnios = costoParaROI / (ahorroMensual * 12);
            
            const areaTotal = numeroPaneles * 2; 
            const tamanoInversor = Math.ceil(potenciaTotal); 

            const co2EvitadoAnual = (produccionAnualEstimada * regionData.gridEmissionFactor);
            const arbolesEquivalentes = Math.ceil(co2EvitadoAnual / 6);

            const plazoMeses = parseInt(dom.plazo.value);
            const tasaInteresMensual = 0.015;
            const cuota = costoTotalSistema * (tasaInteresMensual * Math.pow(1 + tasaInteresMensual, plazoMeses)) / (Math.pow(1 + tasaInteresMensual, plazoMeses) - 1);
            
            const currencyFormatter = new Intl.NumberFormat('es-CO', { style: 'currency', currency: regionData.currency, maximumFractionDigits: 0 });
            
            document.getElementById('numeroPaneles').innerText = numeroPaneles;
            document.getElementById('potenciaTotal').innerText = potenciaTotal.toFixed(2) + " kWp";
            document.getElementById('inversor').innerText = tamanoInversor + " kW";
            document.getElementById('areaRequerida').innerText = areaTotal.toFixed(1) + " m²";
            document.getElementById('costoSistema').innerText = currencyFormatter.format(costoTotalSistema);
            document.getElementById('ahorroMensual').innerText = currencyFormatter.format(ahorroMensual);
            document.getElementById('retornoInversion').innerText = retornoInversionAnios.toFixed(1) + " años";
            document.getElementById('co2Evitado').innerText = (co2EvitadoAnual/1000).toFixed(2) + " tCO₂";
            document.getElementById('arbolesEquivalentes').innerText = arbolesEquivalentes + " árboles";
            document.getElementById('cuotaMensual').innerText = currencyFormatter.format(cuota);
            
            document.getElementById('resultado').style.display = 'block';
            
            const labels = Array.from({ length: 26 }, (_, i) => `Año ${i}`);
            const costoRedElectrica = [];
            const ahorroSolarAcumulado = [];
            let costoAcumuladoRed = 0;
            let ahorroAcumulado = -costoParaROI;
            let produccionAnualActual = produccionAnualEstimada;

            for (let i = 0; i <= 25; i++) {
                costoRedElectrica.push(costoAcumuladoRed);
                ahorroSolarAcumulado.push(ahorroAcumulado);
                costoAcumuladoRed += (consumoMensual * 12 * costoKwh) * Math.pow(1.05, i);
                ahorroAcumulado += (produccionAnualActual * costoKwh);
                produccionAnualActual *= (1 - 0.004);
            }

            if (proyeccionChart) proyeccionChart.destroy();
            proyeccionChart = new Chart(document.getElementById('proyeccionChart').getContext('2d'), {
                type: 'line', data: { labels: labels, datasets: [ { label: 'Costo Acumulado - Red Eléctrica', data: costoRedElectrica, borderColor: '#dc3545', backgroundColor: 'rgba(220, 53, 69, 0.1)', fill: true }, { label: 'Ahorro Neto Acumulado - Solar', data: ahorroSolarAcumulado, borderColor: '#28a745', backgroundColor: 'rgba(40, 167, 69, 0.1)', fill: true } ] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { ticks: { callback: value => currencyFormatter.format(value) } } } }
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            dom.region.innerHTML = Object.entries(REGION_DATA).map(([code, data]) => `<option value="${code}">${data.name}</option>`).join('');
            dom.sombra.innerHTML = `<option value="1.0" data-key="solar_sombra_ninguna">Sin Sombra (Eficiencia 100%)</option><option value="0.85" data-key="solar_sombra_ligera">Sombra Ligera (~85%)</option><option value="0.70" data-key="solar_sombra_parcial">Sombra Parcial (~70%)</option>`;

            dom.region.addEventListener('change', updateUIForRegion);
            dom.consumo.addEventListener('input', e => dom.consumoValue.innerText = e.target.value);
            dom.costoKwh.addEventListener('input', e => {
                 const currency = REGION_DATA[dom.region.value].currency;
                 dom.costoKwhValue.innerText = `${parseFloat(e.target.value).toFixed(2)} ${currency}`;
            });
            dom.costoPorVatio.addEventListener('input', e => {
                const currency = REGION_DATA[dom.region.value].currency;
                const formatter = new Intl.NumberFormat('es-CO', { maximumFractionDigits: regionData.currency === 'EUR' ? 2 : 0 });
                dom.costoPorVatioValue.innerText = `${formatter.format(e.target.value)} ${currency}`;
            });
            
            updateUIForRegion();
        });

        document.getElementById('downloadPdfBtn').addEventListener('click', () => {
            const element = document.getElementById('calculator-content');
            html2pdf().from(element).set({
                margin: 0.5, filename: 'Reporte_Proyecto_Solar_FIDES.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'landscape' }
            }).save();
        });
    </script>
</body>
</html>